% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sim.stacked.segsites.R
\name{sim.stacked.segsites}
\alias{sim.stacked.segsites}
\title{Simulate Segregating Sites using scrm}
\usage{
sim.stacked.segsites(
  model,
  use.alpha = FALSE,
  nsim.blocks = 5,
  block.size = 1000,
  n.sites = 100,
  path = getwd(),
  output.name = "model",
  append.sims = FALSE,
  mu.rates = NULL,
  ncores = 1
)
}
\arguments{
\item{model}{A model object built by the main.menu function.}

\item{use.alpha}{Logical. If TRUE the most recent population size change will be exponential. If FALSE sudden demographic changes. Default is FALSE.}

\item{nsim.blocks}{Number of blocks to simulate. The total number of simulations is: nsim.blocks x block.size (x ncores when ncores > 1).}

\item{block.size}{Simulations are performed in blocks. This argument defines the size of the block in number of simulations, i.e. how many simulations to run per block.
A block of 1000 will work for most cases. Increase the total number of simulations with nsim.blocks argument.}

\item{n.sites}{Integer. Number of segregating site columns in the output matrix. Sites are sorted by frequency and padded/truncated to this size. Default is 100.}

\item{path}{Path to write the output. By default outputs will be saved in the working directory.}

\item{output.name}{String. The prefix of the output names. Default is "model".}

\item{append.sims}{Logical. If TRUE simulations will be appended in the last output. Default is FALSE.}

\item{mu.rates}{List. Distribution to sample the mutation rates. The first element of the list should be the name of the distribution as a character string.
The second element of the list must be the number of loci. The following elements are the parameters of the distribution.
Ex.: mu.rates = list("rtnorm", 1000, 1e-9, 1e-9, 0). If NULL, rates are sampled from the model priors. Default is NULL.}

\item{ncores}{Number of cores for parallel execution. When ncores > 1, separate R worker processes are spawned. Default is 1.}
}
\value{
Writes two files: SEGSITES_{output.name}.txt (one flattened row per replicate, nsam*n.sites columns, no header) and PARAMS_{output.name}.txt (header row followed by one row per replicate with parameter values including mean.rate and sd.rate).
}
\description{
This function simulates segregating sites using the scrm coalescent simulator.
             It outputs a fixed-size 2D matrix (nsam x n.sites) per replicate, suitable for
             machine-learning / CNN-based demographic inference. For each locus, scrm returns a
             0/1 seg_sites matrix which is sorted by mutation frequency, padded/truncated to n.sites,
             then summed across loci into a single integer matrix.
}
\examples{
\dontrun{
# Load example demographic models
data("A_piscivorus", package = "PipeMaster")

# Optimize model for uniform sample sizes
Is_opt <- optimize.sfs.model(Is)
nsam <- sum(as.numeric(Is_opt$I[1, 4:ncol(Is_opt$I)]))

# Quick test run (small block size, single core)
tmpdir <- tempdir()
sim.stacked.segsites(model = Is_opt,
                     nsim.blocks = 1,
                     block.size = 10,
                     n.sites = 50,
                     path = tmpdir,
                     use.alpha = FALSE,
                     output.name = "test_segsites",
                     ncores = 1)

# Read results
ss <- read.table(file.path(tmpdir, "SEGSITES_test_segsites.txt"))
params <- read.table(file.path(tmpdir, "PARAMS_test_segsites.txt"), header = TRUE)

# Each replicate is one row (flattened nsam x n.sites matrix)
nrow(ss)     # 10 replicates
ncol(ss)     # nsam * n.sites

# Reshape one replicate back to matrix
mat <- matrix(as.numeric(ss[1, ]), nrow = nsam, ncol = 50, byrow = TRUE)
}
}
\author{
Marcelo Gehara
}
